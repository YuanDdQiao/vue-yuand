(function(e){function t(t){for(var a,l,n=t[0],i=t[1],u=t[2],m=0,f=[];m<n.length;m++)l=n[m],o[l]&&f.push(o[l][0]),o[l]=0;for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a]);c&&c(t);while(f.length)f.shift()();return s.push.apply(s,u||[]),r()}function r(){for(var e,t=0;t<s.length;t++){for(var r=s[t],a=!0,n=1;n<r.length;n++){var i=r[n];0!==o[i]&&(a=!1)}a&&(s.splice(t--,1),e=l(l.s=r[0]))}return e}var a={},o={app:0},s=[];function l(t){if(a[t])return a[t].exports;var r=a[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,l),r.l=!0,r.exports}l.m=e,l.c=a,l.d=function(e,t,r){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(l.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)l.d(r,a,function(t){return e[t]}.bind(null,a));return r},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],i=n.push.bind(n);n.push=t,n=n.slice();for(var u=0;u<n.length;u++)t(n[u]);var c=i;s.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"00b9":function(e,t,r){"use strict";var a=r("5e52"),o=r.n(a);o.a},"034f":function(e,t,r){"use strict";var a=r("64a9"),o=r.n(a);o.a},"08ee":function(e,t,r){"use strict";var a=r("3fb2"),o=r.n(a);o.a},"3fb2":function(e,t,r){},"56d7":function(e,t,r){"use strict";r.r(t);r("cadf"),r("551c"),r("097d");var a=r("2b0e"),o=r("5c96"),s=r.n(o),l=(r("0fae"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",[r("el-header",[r("app-header"),r("app-nav-menu")],1),r("el-main",[r("div",{attrs:{id:"main-container"}},[r("router-view")],1)]),r("el-footer",[r("app-footer")],1)],1)}),n=[],i=(r("ac4d"),r("8a81"),r("ac6a"),r("bc3a")),u=r.n(i),c=r("8c4f"),m=r("2f62"),f=r("d4ec"),p=r("bee2"),d=function(){function e(){Object(f["a"])(this,e)}return Object(p["a"])(e,[{key:"get",value:function(){return{token:this.getToken(),uid:this.getUid(),username:this.getUsername(),isAdmin:this.getIsAdmin()}}},{key:"getToken",value:function(){return localStorage.getItem("token")||""}},{key:"setToken",value:function(e){return localStorage.setItem("token",e),this}},{key:"clear",value:function(){localStorage.clear()}},{key:"getUid",value:function(){return localStorage.getItem("uid")||""}},{key:"setUid",value:function(e){return localStorage.setItem("uid",e),this}},{key:"getUsername",value:function(){return localStorage.getItem("username")||""}},{key:"setUsername",value:function(e){return localStorage.setItem("username",e),this}},{key:"getIsAdmin",value:function(){var e=localStorage.getItem("is_admin");return"1"===e}},{key:"setIsAdmin",value:function(e){return localStorage.setItem("is_admin",e),this}}]),e}(),h=new d;a["default"].use(m["a"]);var b=new m["a"].Store({state:{hiddenNavMenu:!1,user:h.get()},getters:{user:function(e){return e.user},login:function(e){return""!==e.user.token}},mutations:{hiddenNavMenu:function(e){e.hiddenNavMenu=!0},showNavMenu:function(e){e.hiddenNavMenu=!1},setUser:function(e,t){h.setToken(t.token),h.setUid(t.uid),h.setUsername(t.username),h.setIsAdmin(t.isAdmin),e.user=t},logout:function(e){h.clear(),e.user=h.get()}}}),v=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{title:"您访问的页面不存在",visible:e.dialogVisible,"close-on-click-modal":!1,"show-close":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("el-button",{attrs:{type:"primary"},on:{click:e.jump}},[e._v("确定")])],1)},_=[],g={name:"not-found",data:function(){return{dialogVisible:!0}},methods:{jump:function(){this.$router.push("/")}}},y=g,k=r("2877"),w=Object(k["a"])(y,v,_,!1,null,null,null);w.options.__file="notFound.vue";var x=w.exports,$=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",[r("task-sidebar"),r("el-main",[r("el-form",{attrs:{inline:!0}},[r("el-row",[r("el-form-item",{attrs:{label:"任务ID"}},[r("el-input",{model:{value:e.searchParams.id,callback:function(t){e.$set(e.searchParams,"id","string"===typeof t?t.trim():t)},expression:"searchParams.id"}})],1),r("el-form-item",{attrs:{label:"任务名称"}},[r("el-input",{model:{value:e.searchParams.name,callback:function(t){e.$set(e.searchParams,"name","string"===typeof t?t.trim():t)},expression:"searchParams.name"}})],1),r("el-form-item",{attrs:{label:"标签"}},[r("el-input",{model:{value:e.searchParams.tag,callback:function(t){e.$set(e.searchParams,"tag","string"===typeof t?t.trim():t)},expression:"searchParams.tag"}})],1)],1),r("el-row",[r("el-form-item",{attrs:{label:"执行方式"}},[r("el-select",{model:{value:e.searchParams.protocol,callback:function(t){e.$set(e.searchParams,"protocol","string"===typeof t?t.trim():t)},expression:"searchParams.protocol"}},[r("el-option",{attrs:{label:"全部",value:""}}),e._l(e.protocolList,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})],2)],1),r("el-form-item",{attrs:{label:"任务节点"}},[r("el-select",{model:{value:e.searchParams.host_id,callback:function(t){e.$set(e.searchParams,"host_id","string"===typeof t?t.trim():t)},expression:"searchParams.host_id"}},[r("el-option",{attrs:{label:"全部",value:""}}),e._l(e.hosts,function(e){return r("el-option",{key:e.id,attrs:{label:e.alias+" - "+e.name+":"+e.port,value:e.id}})})],2)],1),r("el-form-item",{attrs:{label:"状态"}},[r("el-select",{model:{value:e.searchParams.status,callback:function(t){e.$set(e.searchParams,"status","string"===typeof t?t.trim():t)},expression:"searchParams.status"}},[r("el-option",{attrs:{label:"全部",value:""}}),e._l(e.statusList,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})],2)],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.search()}}},[e._v("搜索")])],1)],1)],1),r("el-row",{attrs:{type:"flex",justify:"end"}},[r("el-col",{attrs:{span:2}},[this.$store.getters.user.isAdmin?r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.toEdit(null)}}},[e._v("新增")]):e._e()],1),r("el-col",{attrs:{span:2}},[r("el-button",{attrs:{type:"info"},on:{click:e.refresh}},[e._v("刷新")])],1)],1),r("el-pagination",{attrs:{background:"",layout:"prev, pager, next, sizes, total",total:e.taskTotal,"page-size":20},on:{"size-change":e.changePageSize,"current-change":e.changePage,"prev-click":e.changePage,"next-click":e.changePage}}),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tasks,"tooltip-effect":"dark",border:""}},[r("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[r("el-form-item",{attrs:{label:"任务创建时间:"}},[e._v("\r\n              "+e._s(e._f("formatTime")(t.row.created))+" "),r("br")]),r("el-form-item",{attrs:{label:"任务类型:"}},[e._v("\r\n              "+e._s(e._f("formatLevel")(t.row.level))+" "),r("br")]),r("el-form-item",{attrs:{label:"单实例运行:"}},[e._v("\r\n               "+e._s(e._f("formatMulti")(t.row.multi))+" "),r("br")]),r("el-form-item",{attrs:{label:"超时时间:"}},[e._v("\r\n              "+e._s(e._f("formatTimeout")(t.row.timeout))+" "),r("br")]),r("el-form-item",{attrs:{label:"重试次数:"}},[e._v("\r\n              "+e._s(t.row.retry_times)+" "),r("br")]),r("el-form-item",{attrs:{label:"重试间隔:"}},[e._v("\r\n              "+e._s(e._f("formatRetryTimesInterval")(t.row.retry_interval))+"\r\n            ")]),r("br"),r("el-form-item",{attrs:{label:"任务节点"}},e._l(t.row.hosts,function(t){return r("div",{key:t.host_id},[e._v("\r\n                "+e._s(t.alias)+" - "+e._s(t.name)+":"+e._s(t.port)+" "),r("br")])}),0),r("br"),r("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"命令:"}},[e._v("\r\n              "+e._s(t.row.command)+"\r\n            ")]),r("br"),r("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"备注"}},[e._v("\r\n              "+e._s(t.row.remark)+"\r\n            ")])],1)]}}])}),r("el-table-column",{attrs:{prop:"id",label:"任务ID"}}),r("el-table-column",{attrs:{prop:"name",label:"任务名称",width:"150"}}),r("el-table-column",{attrs:{prop:"tag",label:"标签"}}),r("el-table-column",{attrs:{prop:"spec",label:"cron表达式",width:"120"}}),r("el-table-column",{attrs:{label:"下次执行时间",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\r\n          "+e._s(e._f("formatTime")(t.row.next_run_time))+"\r\n        ")]}}])}),r("el-table-column",{attrs:{prop:"protocol",formatter:e.formatProtocol,label:"执行方式"}}),this.isAdmin?r("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.level?r("el-switch",{attrs:{"active-value":1,"inactive-vlaue":0,"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(r){e.changeStatus(t.row)}},model:{value:t.row.status,callback:function(r){e.$set(t.row,"status",r)},expression:"scope.row.status"}}):e._e()]}}])}):r("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.level?r("el-switch",{attrs:{"active-value":1,"inactive-vlaue":0,"active-color":"#13ce66",disabled:!0,"inactive-color":"#ff4949"},model:{value:t.row.status,callback:function(r){e.$set(t.row,"status",r)},expression:"scope.row.status"}}):e._e()]}}])}),this.isAdmin?r("el-table-column",{attrs:{label:"操作",width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-row",[r("el-button",{attrs:{type:"primary"},on:{click:function(r){e.toEdit(t.row)}}},[e._v("编辑")]),r("el-button",{attrs:{type:"success"},on:{click:function(r){e.runTask(t.row)}}},[e._v("手动执行")])],1),r("br"),r("el-row",[r("el-button",{attrs:{type:"info"},on:{click:function(r){e.jumpToLog(t.row)}}},[e._v("查看日志")]),r("el-button",{attrs:{type:"danger"},on:{click:function(r){e.remove(t.row)}}},[e._v("删除")])],1)]}}])}):e._e()],1)],1)],1)},P=[],S=(r("386d"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-aside",{attrs:{width:"150px"}},[r("el-menu",{attrs:{"default-active":e.currentRoute,mode:"vertical","background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b",router:""}},[r("el-menu-item",{attrs:{index:"/task"}},[e._v("定时任务")]),r("el-menu-item",{attrs:{index:"/task/log"}},[e._v("任务日志")])],1)],1)}),T=[],q={name:"task-sidebar",data:function(){return{}},computed:{currentRoute:function(){return"/task/log"===this.$route.path?"/task/log":"/task"}}},j=q,R=Object(k["a"])(j,S,T,!1,null,null,null);R.options.__file="sidebar.vue";var L=R.exports,I={list:function(e,t){Ht.batchGet([{uri:"/task",params:e},{uri:"/host/all"}],t)},detail:function(e,t){Ht.batchGet([{uri:"/task/".concat(e)},{uri:"/host/all"}],t)},update:function(e,t){Ht.post("/task/store",e,t)},remove:function(e,t){Ht.post("/task/remove/".concat(e),{},t)},enable:function(e,t){Ht.post("/task/enable/".concat(e),{},t)},disable:function(e,t){Ht.post("/task/disable/".concat(e),{},t)},run:function(e,t){Ht.get("/task/run/".concat(e),{},t)}},M={name:"task-list",data:function(){return{tasks:[],hosts:[],taskTotal:0,searchParams:{page_size:20,page:1,id:"",protocol:"",name:"",tag:"",host_id:"",status:""},isAdmin:this.$store.getters.user.isAdmin,protocolList:[{value:"1",label:"http"},{value:"2",label:"shell"}],statusList:[{value:"2",label:"激活"},{value:"1",label:"停止"}]}},components:{taskSidebar:L},created:function(){var e=this.$route.query.host_id;e&&(this.searchParams.host_id=e),this.search()},filters:{formatLevel:function(e){return 1===e?"主任务":"子任务"},formatTimeout:function(e){return e>0?e+"秒":"不限制"},formatRetryTimesInterval:function(e){return e>0?e+"秒":"系统默认"},formatMulti:function(e){return e>0?"否":"是"}},methods:{changeStatus:function(e){e.status?I.enable(e.id):I.disable(e.id)},formatProtocol:function(e,t){return 2===e[t.property]?"shell":1===e.http_method?"http-get":"http-post"},changePage:function(e){this.searchParams.page=e,this.search()},changePageSize:function(e){this.searchParams.page_size=e,this.search()},search:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;I.list(this.searchParams,function(r,a){e.tasks=r.data,e.taskTotal=r.total,e.hosts=a,t&&t()})},runTask:function(e){var t=this;this.$appConfirm(function(){I.run(e.id,function(){t.$message.success("任务已开始执行")})},!0)},remove:function(e){var t=this;this.$appConfirm(function(){I.remove(e.id,function(){t.refresh()})})},jumpToLog:function(e){this.$router.push("/task/log?task_id=".concat(e.id))},refresh:function(){var e=this;this.search(function(){e.$message.success("刷新成功")})},toEdit:function(e){var t="";t=null===e?"/task/create":"/task/edit/".concat(e.id),this.$router.push(t)}}},z=M,A=(r("7229"),Object(k["a"])(z,$,P,!1,null,"d1776a6a",null));A.options.__file="list.vue";var E=A.exports,O=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",[r("task-sidebar"),r("el-main",[r("el-form",{ref:"form",attrs:{model:e.form,rules:e.formRules,"label-width":"180px"}},[r("el-input",{attrs:{type:"hidden"},model:{value:e.form.id,callback:function(t){e.$set(e.form,"id",t)},expression:"form.id"}}),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"任务名称",prop:"name"}},[r("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name","string"===typeof t?t.trim():t)},expression:"form.name"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"标签"}},[r("el-input",{attrs:{placeholder:"通过标签将任务分组"},model:{value:e.form.tag,callback:function(t){e.$set(e.form,"tag","string"===typeof t?t.trim():t)},expression:"form.tag"}})],1)],1)],1),1===e.form.level?r("el-row",[r("el-col",[r("el-alert",{attrs:{title:"主任务可以配置多个子任务, 当主任务执行完成后，自动执行子任务\n任务类型新增后不能变更",type:"info",closable:!1}}),r("el-alert",{attrs:{title:"强依赖: 主任务执行成功，才会运行子任务\n弱依赖: 无论主任务执行是否成功，都会运行子任务",type:"info",closable:!1}}),r("br")],1)],1):e._e(),r("el-row",[r("el-col",{attrs:{span:7}},[r("el-form-item",{attrs:{label:"任务类型"}},[r("el-select",{attrs:{disabled:""!==e.form.id},model:{value:e.form.level,callback:function(t){e.$set(e.form,"level","string"===typeof t?t.trim():t)},expression:"form.level"}},e._l(e.levelList,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),1===e.form.level?r("el-col",{attrs:{span:7}},[r("el-form-item",{attrs:{label:"依赖关系"}},[r("el-select",{model:{value:e.form.dependency_status,callback:function(t){e.$set(e.form,"dependency_status","string"===typeof t?t.trim():t)},expression:"form.dependency_status"}},e._l(e.dependencyStatusList,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1):e._e(),r("el-col",{attrs:{span:10}},[1===e.form.level?r("el-form-item",{attrs:{label:"子任务ID"}},[r("el-input",{attrs:{placeholder:"多个ID逗号分隔"},model:{value:e.form.dependency_task_id,callback:function(t){e.$set(e.form,"dependency_task_id","string"===typeof t?t.trim():t)},expression:"form.dependency_task_id"}})],1):e._e()],1)],1),1===e.form.level?r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"crontab表达式",prop:"spec"}},[r("el-input",{attrs:{placeholder:"秒 分 时 天 月 周"},model:{value:e.form.spec,callback:function(t){e.$set(e.form,"spec","string"===typeof t?t.trim():t)},expression:"form.spec"}})],1)],1)],1):e._e(),r("el-row",[r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"执行方式"}},[r("el-select",{model:{value:e.form.protocol,callback:function(t){e.$set(e.form,"protocol","string"===typeof t?t.trim():t)},expression:"form.protocol"}},e._l(e.protocolList,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),1===e.form.protocol?r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"请求方法"}},[r("el-select",{key:"http-method",model:{value:e.form.http_method,callback:function(t){e.$set(e.form,"http_method","string"===typeof t?t.trim():t)},expression:"form.http_method"}},e._l(e.httpMethods,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1):r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"任务节点"}},[r("el-select",{key:"shell",attrs:{filterable:"",multiple:"",placeholder:"请选择"},model:{value:e.selectedHosts,callback:function(t){e.selectedHosts=t},expression:"selectedHosts"}},e._l(e.hosts,function(e){return r("el-option",{key:e.id,attrs:{label:e.alias+" - "+e.name,value:e.id}})}),1)],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:16}},[r("el-form-item",{attrs:{label:"命令",prop:"command"}},[r("el-input",{attrs:{type:"textarea",rows:5,size:"medium",width:"100",placeholder:e.commandPlaceholder},model:{value:e.form.command,callback:function(t){e.$set(e.form,"command",t)},expression:"form.command"}})],1)],1)],1),r("el-row",[r("el-col",[r("el-alert",{attrs:{title:"任务执行超时强制结束, 取值0-86400(秒), 默认0, 不限制",type:"info",closable:!1}}),r("el-alert",{attrs:{title:"单实例运行, 前次任务未执行完成，下次任务调度时间到了是否要执行, 即是否允许多进程执行同一任务",type:"info",closable:!1}}),r("br")],1)],1),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"任务超时时间",prop:"timeout"}},[r("el-input",{model:{value:e.form.timeout,callback:function(t){e.$set(e.form,"timeout",e._n("string"===typeof t?t.trim():t))},expression:"form.timeout"}})],1)],1),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"单实例运行"}},[r("el-select",{model:{value:e.form.multi,callback:function(t){e.$set(e.form,"multi","string"===typeof t?t.trim():t)},expression:"form.multi"}},e._l(e.runStatusList,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"任务失败重试次数",prop:"retry_times"}},[r("el-input",{attrs:{placeholder:"0 - 10, 默认0，不重试"},model:{value:e.form.retry_times,callback:function(t){e.$set(e.form,"retry_times",e._n("string"===typeof t?t.trim():t))},expression:"form.retry_times"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"任务失败重试间隔时间",prop:"retry_interval"}},[r("el-input",{attrs:{placeholder:"0 - 3600 (秒), 默认0，执行系统默认策略"},model:{value:e.form.retry_interval,callback:function(t){e.$set(e.form,"retry_interval",e._n("string"===typeof t?t.trim():t))},expression:"form.retry_interval"}})],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"任务通知"}},[r("el-select",{model:{value:e.form.notify_status,callback:function(t){e.$set(e.form,"notify_status","string"===typeof t?t.trim():t)},expression:"form.notify_status"}},e._l(e.notifyStatusList,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),1!==e.form.notify_status?r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"通知类型"}},[r("el-select",{model:{value:e.form.notify_type,callback:function(t){e.$set(e.form,"notify_type","string"===typeof t?t.trim():t)},expression:"form.notify_type"}},e._l(e.notifyTypes,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1):e._e(),1!==e.form.notify_status&&2===e.form.notify_type?r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"接收用户"}},[r("el-select",{key:"notify-mail",attrs:{filterable:"",multiple:"",placeholder:"请选择"},model:{value:e.selectedMailNotifyIds,callback:function(t){e.selectedMailNotifyIds=t},expression:"selectedMailNotifyIds"}},e._l(e.mailUsers,function(e){return r("el-option",{key:e.id,attrs:{label:e.username,value:e.id}})}),1)],1)],1):e._e(),1!==e.form.notify_status&&3===e.form.notify_type?r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"发送Channel"}},[r("el-select",{key:"notify-slack",attrs:{filterable:"",multiple:"",placeholder:"请选择"},model:{value:e.selectedSlackNotifyIds,callback:function(t){e.selectedSlackNotifyIds=t},expression:"selectedSlackNotifyIds"}},e._l(e.slackChannels,function(e){return r("el-option",{key:e.id,attrs:{label:e.name,selected:"true",value:e.id}})}),1)],1)],1):e._e()],1),4===e.form.notify_status?r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"任务执行输出关键字",prop:"notify_keyword"}},[r("el-input",{attrs:{placeholder:"任务执行输出中包含此关键字将触发通知"},model:{value:e.form.notify_keyword,callback:function(t){e.$set(e.form,"notify_keyword","string"===typeof t?t.trim():t)},expression:"form.notify_keyword"}})],1)],1)],1):e._e(),r("el-row",[r("el-col",{attrs:{span:16}},[r("el-form-item",{attrs:{label:"备注"}},[r("el-input",{attrs:{type:"textarea",rows:3,size:"medium",width:"100"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1)],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("保存")]),r("el-button",{on:{click:e.cancel}},[e._v("取消")])],1)],1)],1)],1)},N=[],U=(r("28a5"),r("7f7f"),{slack:function(e){Ht.get("/system/slack",{},e)},updateSlack:function(e,t){Ht.post("/system/slack/update",e,t)},createSlackChannel:function(e,t){Ht.post("/system/slack/channel",{channel:e},t)},removeSlackChannel:function(e,t){Ht.post("/system/slack/channel/remove/".concat(e),{},t)},mail:function(e){Ht.get("/system/mail",{},e)},updateMail:function(e,t){Ht.post("/system/mail/update",e,t)},createMailUser:function(e,t){Ht.post("/system/mail/user",e,t)},removeMailUser:function(e,t){Ht.post("/system/mail/user/remove/".concat(e),{},t)},webhook:function(e){Ht.get("/system/webhook",{},e)},updateWebHook:function(e,t){Ht.post("/system/webhook/update",e,t)}}),C={name:"task-edit",data:function(){return{form:{id:"",name:"",tag:"",level:1,dependency_status:1,dependency_task_id:"",spec:"",protocol:2,http_method:1,command:"",host_id:"",timeout:0,multi:2,notify_status:1,notify_type:2,notify_receiver_id:"",notify_keyword:"",retry_times:0,retry_interval:0,remark:""},formRules:{name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],spec:[{required:!0,message:"请输入crontab表达式",trigger:"blur"}],command:[{required:!0,message:"请输入命令",trigger:"blur"}],timeout:[{type:"number",required:!0,message:"请输入有效的任务超时时间",trigger:"blur"}],retry_times:[{type:"number",required:!0,message:"请输入有效的任务执行失败重试次数",trigger:"blur"}],retry_interval:[{type:"number",required:!0,message:"请输入有效的任务执行失败，重试间隔时间",trigger:"blur"}],notify_keyword:[{required:!0,message:"请输入要匹配的任务执行输出关键字",trigger:"blur"}]},httpMethods:[{value:1,label:"get"},{value:2,label:"post"}],protocolList:[{value:1,label:"http"},{value:2,label:"shell"}],levelList:[{value:1,label:"主任务"},{value:2,label:"子任务"}],dependencyStatusList:[{value:1,label:"强依赖"},{value:2,label:"弱依赖"}],runStatusList:[{value:2,label:"是"},{value:1,label:"否"}],notifyStatusList:[{value:1,label:"不通知"},{value:2,label:"失败通知"},{value:3,label:"总是通知"},{value:4,label:"关键字匹配通知"}],notifyTypes:[{value:2,label:"邮件"},{value:3,label:"Slack"},{value:4,label:"WebHook"}],hosts:[],mailUsers:[],slackChannels:[],selectedHosts:[],selectedMailNotifyIds:[],selectedSlackNotifyIds:[]}},computed:{commandPlaceholder:function(){return 1===this.form.protocol?"请输入URL地址":"请输入shell命令"}},components:{taskSidebar:L},created:function(){var e=this,t=this.$route.params.id;I.detail(t,function(r,a){if(t&&!r)return e.$message.error("数据不存在"),void e.cancel();if(e.hosts=a||[],r&&(e.form.id=r.id,e.form.name=r.name,e.form.tag=r.tag,e.form.level=r.level,r.dependency_status&&(e.form.dependency_status=r.dependency_status),e.form.dependency_task_id=r.dependency_task_id,e.form.spec=r.spec,e.form.protocol=r.protocol,r.http_method&&(e.form.http_method=r.http_method),e.form.command=r.command,e.form.timeout=r.timeout,e.form.multi=r.multi?1:2,e.form.notify_keyword=r.notify_keyword,e.form.notify_status=r.notify_status+1,e.form.notify_receiver_id=r.notify_receiver_id,r.notify_type&&(e.form.notify_type=r.notify_type+1),e.form.retry_times=r.retry_times,e.form.retry_interval=r.retry_interval,e.form.remark=r.remark,r.hosts=r.hosts||[],2===e.form.protocol&&r.hosts.forEach(function(t){e.selectedHosts.push(t.host_id)}),e.form.notify_status>1)){var o=e.form.notify_receiver_id.split(",");2===e.form.notify_type?o.forEach(function(t){e.selectedMailNotifyIds.push(parseInt(t))}):3===e.form.notify_type&&o.forEach(function(t){e.selectedSlackNotifyIds.push(parseInt(t))})}}),U.mail(function(t){e.mailUsers=t.mail_users}),U.slack(function(t){e.slackChannels=t.channels})},methods:{submit:function(){var e=this;this.$refs["form"].validate(function(t){if(!t)return!1;if(2===e.form.protocol&&0===e.selectedHosts.length)return e.$message.error("请选择任务节点"),!1;if(e.form.notify_status>1){if(2===e.form.notify_type&&0===e.selectedMailNotifyIds.length)return e.$message.error("请选择邮件接收用户"),!1;if(3===e.form.notify_type&&0===e.selectedSlackNotifyIds.length)return e.$message.error("请选择Slack Channel"),!1}e.save()})},save:function(){var e=this;2===this.form.protocol&&this.selectedHosts.length>0&&(this.form.host_id=this.selectedHosts.join(",")),this.form.notify_status>1&&2===this.form.notify_type&&(this.form.notify_receiver_id=this.selectedMailNotifyIds.join(",")),this.form.notify_status>1&&3===this.form.notify_type&&(this.form.notify_receiver_id=this.selectedSlackNotifyIds.join(",")),I.update(this.form,function(){e.$router.push("/task")})},cancel:function(){this.$router.push("/task")}}},V=C,H=Object(k["a"])(V,O,N,!1,null,null,null);H.options.__file="edit.vue";var D=H.exports,W=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",[r("task-sidebar"),r("el-main",[r("el-form",{attrs:{inline:!0}},[r("el-form-item",{attrs:{label:"任务ID"}},[r("el-input",{model:{value:e.searchParams.task_id,callback:function(t){e.$set(e.searchParams,"task_id","string"===typeof t?t.trim():t)},expression:"searchParams.task_id"}})],1),r("el-form-item",{attrs:{label:"执行方式"}},[r("el-select",{attrs:{placeholder:"执行方式"},model:{value:e.searchParams.protocol,callback:function(t){e.$set(e.searchParams,"protocol","string"===typeof t?t.trim():t)},expression:"searchParams.protocol"}},[r("el-option",{attrs:{label:"全部",value:""}}),e._l(e.protocolList,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})],2)],1),r("el-form-item",{attrs:{label:"状态"}},[r("el-select",{model:{value:e.searchParams.status,callback:function(t){e.$set(e.searchParams,"status","string"===typeof t?t.trim():t)},expression:"searchParams.status"}},[r("el-option",{attrs:{label:"全部",value:""}}),e._l(e.statusList,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})],2)],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.search()}}},[e._v("搜索")])],1)],1),r("el-row",{attrs:{type:"flex",justify:"end"}},[r("el-col",{attrs:{span:3}},[this.$store.getters.user.isAdmin?r("el-button",{attrs:{type:"danger"},on:{click:e.clearLog}},[e._v("清空日志")]):e._e()],1),r("el-col",{attrs:{span:2}},[r("el-button",{attrs:{type:"info"},on:{click:e.refresh}},[e._v("刷新")])],1)],1),r("el-pagination",{attrs:{background:"",layout:"prev, pager, next, sizes, total",total:e.logTotal,"page-size":20},on:{"size-change":e.changePageSize,"current-change":e.changePage,"prev-click":e.changePage,"next-click":e.changePage}}),r("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:e.logs,border:""}},[r("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-form",{attrs:{"label-position":"left"}},[r("el-form-item",[e._v("\n                重试次数: "+e._s(t.row.retry_times)+" "),r("br"),e._v("\n                cron表达式: "+e._s(t.row.spec)+" "),r("br"),e._v("\n                命令: "+e._s(t.row.command)+"\n            ")])],1)]}}])}),r("el-table-column",{attrs:{prop:"id",label:"ID"}}),r("el-table-column",{attrs:{prop:"task_id",label:"任务ID"}}),r("el-table-column",{attrs:{prop:"name",label:"任务名称",width:"180"}}),r("el-table-column",{attrs:{prop:"protocol",label:"执行方式",formatter:e.formatProtocol}}),r("el-table-column",{attrs:{label:"任务节点",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",{domProps:{innerHTML:e._s(t.row.hostname)}},[e._v(e._s(t.row.hostname))])]}}])}),r("el-table-column",{attrs:{label:"执行时长",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          执行时长: "+e._s(t.row.total_time>0?t.row.total_time:1)+"秒"),r("br"),e._v("\n          开始时间: "+e._s(e._f("formatTime")(t.row.start_time))),r("br"),1!==t.row.status?r("span",[e._v("结束时间: "+e._s(e._f("formatTime")(t.row.end_time)))]):e._e()]}}])}),r("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[0===t.row.status?r("span",{staticStyle:{color:"red"}},[e._v("失败")]):1===t.row.status?r("span",{staticStyle:{color:"green"}},[e._v("执行中")]):2===t.row.status?r("span",[e._v("成功")]):3===t.row.status?r("span",{staticStyle:{color:"#4499EE"}},[e._v("取消")]):e._e()]}}])}),this.isAdmin?r("el-table-column",{attrs:{label:"执行结果",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[2===t.row.status?r("el-button",{attrs:{type:"success"},on:{click:function(r){e.showTaskResult(t.row)}}},[e._v("查看结果")]):e._e(),0===t.row.status?r("el-button",{attrs:{type:"warning"},on:{click:function(r){e.showTaskResult(t.row)}}},[e._v("查看结果")]):e._e(),1===t.row.status&&2===t.row.protocol?r("el-button",{attrs:{type:"danger"},on:{click:function(r){e.stopTask(t.row)}}},[e._v("停止任务\n          ")]):e._e()]}}])}):r("el-table-column",{attrs:{label:"执行结果",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[2===t.row.status?r("el-button",{attrs:{type:"success"},on:{click:function(r){e.showTaskResult(t.row)}}},[e._v("查看结果")]):e._e(),0===t.row.status?r("el-button",{attrs:{type:"warning"},on:{click:function(r){e.showTaskResult(t.row)}}},[e._v("查看结果")]):e._e()]}}])})],1),r("el-dialog",{attrs:{title:"任务执行结果",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("div",[r("pre",[e._v(e._s(e.currentTaskResult.command))])]),r("div",[r("pre",[e._v(e._s(e.currentTaskResult.result))])])])],1)],1)},F=[],G={list:function(e,t){Ht.get("/task/log",e,t)},clear:function(e){Ht.post("/task/log/clear",{},e)},stop:function(e,t,r){Ht.post("/task/log/stop",{id:e,task_id:t},r)}},B={name:"task-log",data:function(){return{logs:[],logTotal:0,searchParams:{page_size:20,page:1,task_id:"",protocol:"",status:""},isAdmin:this.$store.getters.user.isAdmin,dialogVisible:!1,currentTaskResult:{command:"",result:""},protocolList:[{value:"1",label:"http"},{value:"2",label:"shell"}],statusList:[{value:"1",label:"失败"},{value:"2",label:"执行中"},{value:"3",label:"成功"},{value:"4",label:"取消"}]}},components:{taskSidebar:L},created:function(){this.$route.query.task_id&&(this.searchParams.task_id=this.$route.query.task_id),this.search()},methods:{formatProtocol:function(e,t){return 1===e[t.property]?"http":"shell"},changePage:function(e){this.searchParams.page=e,this.search()},changePageSize:function(e){this.searchParams.page_size=e,this.search()},search:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;G.list(this.searchParams,function(r){e.logs=r.data,e.logTotal=r.total,t&&t()})},clearLog:function(){var e=this;this.$appConfirm(function(){G.clear(function(){e.searchParams.page=1,e.search()})})},stopTask:function(e){var t=this;G.stop(e.id,e.task_id,function(){t.search()})},showTaskResult:function(e){this.dialogVisible=!0,this.currentTaskResult.command=e.command,this.currentTaskResult.result=e.result},refresh:function(){var e=this;this.search(function(){e.$message.success("刷新成功")})}}},J=B,Q=(r("08ee"),Object(k["a"])(J,W,F,!1,null,"5048f063",null));Q.options.__file="list.vue";var Y=Q.exports,K=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",[r("el-main",[r("el-form",{attrs:{inline:!0}},[r("el-row",[r("el-form-item",{attrs:{label:"节点ID"}},[r("el-input",{model:{value:e.searchParams.id,callback:function(t){e.$set(e.searchParams,"id","string"===typeof t?t.trim():t)},expression:"searchParams.id"}})],1),r("el-form-item",{attrs:{label:"主机名"}},[r("el-input",{model:{value:e.searchParams.name,callback:function(t){e.$set(e.searchParams,"name","string"===typeof t?t.trim():t)},expression:"searchParams.name"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.search()}}},[e._v("搜索")])],1)],1)],1),r("el-row",{attrs:{type:"flex",justify:"end"}},[r("el-col",{attrs:{span:2}},[this.$store.getters.user.isAdmin?r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.toEdit(null)}}},[e._v("新增")]):e._e()],1),r("el-col",{attrs:{span:2}},[r("el-button",{attrs:{type:"info"},on:{click:e.refresh}},[e._v("刷新")])],1)],1),r("el-pagination",{attrs:{background:"",layout:"prev, pager, next, sizes, total",total:e.hostTotal,"page-size":20},on:{"size-change":e.changePageSize,"current-change":e.changePage,"prev-click":e.changePage,"next-click":e.changePage}}),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.hosts,"tooltip-effect":"dark",border:""}},[r("el-table-column",{attrs:{prop:"id",label:"节点ID"}}),r("el-table-column",{attrs:{prop:"alias",label:"节点名称"}}),r("el-table-column",{attrs:{prop:"name",label:"主机名"}}),r("el-table-column",{attrs:{prop:"port",label:"端口"}}),r("el-table-column",{attrs:{label:"查看任务"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"success"},on:{click:function(r){e.toTasks(t.row)}}},[e._v("查看任务")])]}}])}),r("el-table-column",{attrs:{prop:"remark",label:"备注"}}),this.isAdmin?r("el-table-column",{attrs:{label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-row",[r("el-button",{attrs:{type:"primary"},on:{click:function(r){e.toEdit(t.row)}}},[e._v("编辑")]),r("el-button",{attrs:{type:"info"},on:{click:function(r){e.ping(t.row)}}},[e._v("测试连接")]),r("el-button",{attrs:{type:"danger"},on:{click:function(r){e.remove(t.row)}}},[e._v("删除")])],1),r("br")]}}])}):e._e()],1)],1)],1)},X=[],Z={list:function(e,t){Ht.get("/host",e,t)},all:function(e,t){Ht.get("/host/all",{},t)},detail:function(e,t){Ht.get("/host/".concat(e),{},t)},update:function(e,t){Ht.post("/host/store",e,t)},remove:function(e,t){Ht.post("/host/remove/".concat(e),{},t)},ping:function(e,t){Ht.get("/host/ping/".concat(e),{},t)}},ee={name:"host-list",data:function(){return{hosts:[],hostTotal:0,searchParams:{page_size:20,page:1,id:"",name:"",alias:""},isAdmin:this.$store.getters.user.isAdmin}},created:function(){this.search()},methods:{changePage:function(e){this.searchParams.page=e,this.search()},changePageSize:function(e){this.searchParams.page_size=e,this.search()},search:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Z.list(this.searchParams,function(r){e.hosts=r.data,e.hostTotal=r.total,t&&t()})},remove:function(e){var t=this;this.$appConfirm(function(){Z.remove(e.id,function(){return t.refresh()})})},ping:function(e){var t=this;Z.ping(e.id,function(){t.$message.success("连接成功")})},toEdit:function(e){var t="";t=null===e?"/host/create":"/host/edit/".concat(e.id),this.$router.push(t)},refresh:function(){var e=this;this.search(function(){e.$message.success("刷新成功")})},toTasks:function(e){this.$router.push({path:"/task",query:{host_id:e.id}})}}},te=ee,re=Object(k["a"])(te,K,X,!1,null,null,null);re.options.__file="list.vue";var ae=re.exports,oe=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",[r("el-main",[r("el-form",{ref:"form",staticStyle:{width:"500px"},attrs:{model:e.form,rules:e.formRules,"label-width":"100px"}},[r("el-form-item",[r("el-input",{attrs:{type:"hidden"},model:{value:e.form.id,callback:function(t){e.$set(e.form,"id",t)},expression:"form.id"}})],1),r("el-form-item",{attrs:{label:"节点名称",prop:"alias"}},[r("el-input",{model:{value:e.form.alias,callback:function(t){e.$set(e.form,"alias",t)},expression:"form.alias"}})],1),r("el-form-item",{attrs:{label:"主机名",prop:"name"}},[r("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),r("el-form-item",{attrs:{label:"端口",prop:"port"}},[r("el-input",{model:{value:e.form.port,callback:function(t){e.$set(e.form,"port",e._n(t))},expression:"form.port"}})],1),r("el-form-item",{attrs:{label:"备注"}},[r("el-input",{attrs:{type:"textarea",rows:5,size:"medium",width:"100"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submit()}}},[e._v("保存")]),r("el-button",{on:{click:e.cancel}},[e._v("取消")])],1)],1)],1)],1)},se=[],le={name:"edit",data:function(){return{form:{id:"",name:"",port:5921,alias:"",remark:""},formRules:{name:[{required:!0,message:"请输入主机名",trigger:"blur"}],port:[{required:!0,message:"请输入端口",trigger:"blur"},{type:"number",message:"端口无效"}],alias:[{required:!0,message:"请输入节点名称",trigger:"blur"}]}}},created:function(){var e=this,t=this.$route.params.id;t&&Z.detail(t,function(t){if(!t)return e.$message.error("数据不存在"),void e.cancel();e.form.id=t.id,e.form.name=t.name,e.form.port=t.port,e.form.alias=t.alias,e.form.remark=t.remark})},methods:{submit:function(){var e=this;this.$refs["form"].validate(function(t){if(!t)return!1;e.save()})},save:function(){var e=this;Z.update(this.form,function(){e.$router.push("/host")})},cancel:function(){this.$router.push("/host")}}},ne=le,ie=Object(k["a"])(ne,oe,se,!1,null,null,null);ie.options.__file="edit.vue";var ue=ie.exports,ce=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",[r("el-main",[r("el-row",{attrs:{type:"flex",justify:"end"}},[r("el-col",{attrs:{span:2}},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.toEdit(null)}}},[e._v("新增")])],1),r("el-col",{attrs:{span:2}},[r("el-button",{attrs:{type:"info"},on:{click:e.refresh}},[e._v("刷新")])],1)],1),r("el-pagination",{attrs:{background:"",layout:"prev, pager, next, sizes, total",total:e.userTotal,"page-size":20},on:{"size-change":e.changePageSize,"current-change":e.changePage,"prev-click":e.changePage,"next-click":e.changePage}}),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.users,"tooltip-effect":"dark",border:""}},[r("el-table-column",{attrs:{prop:"id",label:"用户id"}}),r("el-table-column",{attrs:{prop:"name",label:"用户名"}}),r("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),r("el-table-column",{attrs:{prop:"is_admin",formatter:e.formatRole,label:"角色"}}),r("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-switch",{attrs:{"active-value":1,"inactive-vlaue":0,"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(r){e.changeStatus(t.row)}},model:{value:t.row.status,callback:function(r){e.$set(t.row,"status",r)},expression:"scope.row.status"}})]}}])}),this.isAdmin?r("el-table-column",{attrs:{label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-row",[r("el-button",{attrs:{type:"primary"},on:{click:function(r){e.toEdit(t.row)}}},[e._v("编辑")]),r("el-button",{attrs:{type:"success"},on:{click:function(r){e.editPassword(t.row)}}},[e._v("修改密码")]),r("el-button",{attrs:{type:"danger"},on:{click:function(r){e.remove(t.row)}}},[e._v("删除")])],1),r("br")]}}])}):e._e()],1)],1)],1)},me=[],fe={list:function(e,t){Ht.get("/user",{},t)},detail:function(e,t){Ht.get("/user/".concat(e),{},t)},update:function(e,t){Ht.post("/user/store",e,t)},login:function(e,t,r){Ht.post("/user/login",{username:e,password:t},r)},enable:function(e,t){Ht.post("/user/enable/".concat(e),{},t)},disable:function(e,t){Ht.post("/user/disable/".concat(e),{},t)},remove:function(e,t){Ht.post("/user/remove/".concat(e),{},t)},editPassword:function(e,t){Ht.post("/user/editPassword/".concat(e.id),{new_password:e.new_password,confirm_new_password:e.confirm_new_password},t)},editMyPassword:function(e,t){Ht.post("/user/editMyPassword",e,t)}},pe={name:"user-list",data:function(){return{users:[],userTotal:0,searchParams:{page_size:20,page:1},isAdmin:this.$store.getters.user.isAdmin}},created:function(){this.search()},methods:{changeStatus:function(e){e.status?fe.enable(e.id):fe.disable(e.id)},formatRole:function(e,t){return 1===e[t.property]?"管理员":"普通用户"},changePage:function(e){this.searchParams.page=e,this.search()},changePageSize:function(e){this.searchParams.page_size=e,this.search()},search:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;fe.list(this.searchParams,function(r){e.users=r.data,e.userTotal=r.total,t&&t()})},remove:function(e){var t=this;this.$appConfirm(function(){fe.remove(e.id,function(){t.refresh()})})},toEdit:function(e){var t="";t=null===e?"/user/create":"/user/edit/".concat(e.id),this.$router.push(t)},refresh:function(){var e=this;this.search(function(){e.$message.success("刷新成功")})},editPassword:function(e){this.$router.push("/user/edit-password/".concat(e.id))}}},de=pe,he=Object(k["a"])(de,ce,me,!1,null,null,null);he.options.__file="list.vue";var be=he.exports,ve=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",[r("el-main",[r("el-form",{ref:"form",staticStyle:{width:"500px"},attrs:{model:e.form,rules:e.formRules,"label-width":"100px"}},[r("el-form-item",[r("el-input",{attrs:{type:"hidden"},model:{value:e.form.id,callback:function(t){e.$set(e.form,"id",t)},expression:"form.id"}})],1),r("el-form-item",{attrs:{label:"用户名",prop:"name"}},[r("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),r("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[r("el-input",{model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),e.form.id?e._e():[r("el-form-item",{attrs:{label:"密码",prop:"password"}},[r("el-input",{attrs:{type:"password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),r("el-form-item",{attrs:{label:"确认密码",prop:"confirm_password"}},[r("el-input",{attrs:{type:"password"},model:{value:e.form.confirm_password,callback:function(t){e.$set(e.form,"confirm_password",t)},expression:"form.confirm_password"}})],1)],r("el-form-item",{attrs:{label:"角色",prop:"is_admin"}},[r("el-radio-group",{model:{value:e.form.is_admin,callback:function(t){e.$set(e.form,"is_admin",t)},expression:"form.is_admin"}},[r("el-radio",{attrs:{label:0}},[e._v("普通用户")]),r("el-radio",{attrs:{label:1}},[e._v("管理员")])],1)],1),r("el-form-item",{attrs:{label:"状态",prop:"status"}},[r("el-radio-group",{model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},[r("el-radio",{attrs:{label:1}},[e._v("启用")]),r("el-radio",{attrs:{label:0}},[e._v("禁用")])],1)],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submit()}}},[e._v("保存")]),r("el-button",{on:{click:e.cancel}},[e._v("取消")])],1)],2)],1)],1)},_e=[],ge={name:"user-edit",data:function(){return{form:{id:"",name:"",email:"",is_admin:0,password:"",confirm_password:"",status:1},formRules:{name:[{required:!0,message:"请输入用户名",trigger:"blur"}],email:[{type:"email",required:!0,message:"请输入有效邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],confirm_password:[{required:!0,message:"请再次输入密码",trigger:"blur"}]}}},created:function(){var e=this,t=this.$route.params.id;t&&fe.detail(t,function(t){t?(e.form.id=t.id,e.form.name=t.name,e.form.email=t.email,e.form.is_admin=t.is_admin,e.form.status=t.status):e.$message.error("数据不存在")})},methods:{submit:function(){var e=this;this.$refs["form"].validate(function(t){if(!t)return!1;e.save()})},save:function(){var e=this;fe.update(this.form,function(){e.$router.push("/user")})},cancel:function(){this.$router.push("/user")}}},ye=ge,ke=Object(k["a"])(ye,ve,_e,!1,null,null,null);ke.options.__file="edit.vue";var we=ke.exports,xe=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-dialog",{attrs:{title:"用户登录",visible:e.dialogVisible,"close-on-click-modal":!1,"show-close":!1,"close-on-press-escape":!1,width:"40%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px",rules:e.formRules}},[r("el-form-item",{attrs:{label:"用户名",prop:"username"}},[r("el-col",{attrs:{span:16}},[r("el-input",{attrs:{placeholder:"请输入用户名或邮箱"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username","string"===typeof t?t.trim():t)},expression:"form.username"}})],1)],1),r("el-form-item",{attrs:{label:"密码",prop:"password"}},[r("el-col",{attrs:{span:16}},[r("el-input",{attrs:{type:"password",placeholder:"请输入密码"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password","string"===typeof t?t.trim():t)},expression:"form.password"}})],1)],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("登录")])],1)],1)],1)],1)},$e=[],Pe={name:"login",data:function(){return{form:{username:"",password:""},formRules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},dialogVisible:!0}},methods:{submit:function(){var e=this;this.$refs["form"].validate(function(t){if(!t)return!1;e.login()})},login:function(){var e=this;fe.login(this.form.username,this.form.password,function(t){e.$store.commit("setUser",{token:t.token,uid:t.uid,username:t.username,isAdmin:t.is_admin}),e.$router.push(e.$route.query.redirect||"/")})}}},Se=Pe,Te=Object(k["a"])(Se,xe,$e,!1,null,null,null);Te.options.__file="login.vue";var qe=Te.exports,je=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",[r("el-main",[r("el-form",{ref:"form",staticStyle:{width:"500px"},attrs:{model:e.form,rules:e.formRules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"新密码",prop:"new_password"}},[r("el-input",{attrs:{type:"password"},model:{value:e.form.new_password,callback:function(t){e.$set(e.form,"new_password",t)},expression:"form.new_password"}})],1),r("el-form-item",{attrs:{label:"确认新密码",prop:"confirm_new_password"}},[r("el-input",{attrs:{type:"password"},model:{value:e.form.confirm_new_password,callback:function(t){e.$set(e.form,"confirm_new_password",t)},expression:"form.confirm_new_password"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submit()}}},[e._v("保存")]),r("el-button",{on:{click:e.cancel}},[e._v("取消")])],1)],1)],1)],1)},Re=[],Le={name:"user-edit-password",data:function(){return{form:{id:"",new_password:"",confirm_new_password:""},formRules:{new_password:[{required:!0,message:"请输入新密码",trigger:"blur"}],confirm_new_password:[{required:!0,message:"请再次输入新密码",trigger:"blur"}]}}},created:function(){var e=this.$route.params.id;e&&(this.form.id=e)},methods:{submit:function(){var e=this;this.$refs["form"].validate(function(t){if(!t)return!1;e.save()})},save:function(){var e=this;fe.editPassword(this.form,function(){e.$router.push("/user")})},cancel:function(){this.$router.push("/user")}}},Ie=Le,Me=Object(k["a"])(Ie,je,Re,!1,null,null,null);Me.options.__file="editPassword.vue";var ze=Me.exports,Ae=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",[r("el-main",[r("el-form",{ref:"form",staticStyle:{width:"500px"},attrs:{model:e.form,rules:e.formRules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"原密码",prop:"old_password"}},[r("el-input",{attrs:{type:"password"},model:{value:e.form.old_password,callback:function(t){e.$set(e.form,"old_password",t)},expression:"form.old_password"}})],1),r("el-form-item",{attrs:{label:"新密码",prop:"new_password"}},[r("el-input",{attrs:{type:"password"},model:{value:e.form.new_password,callback:function(t){e.$set(e.form,"new_password",t)},expression:"form.new_password"}})],1),r("el-form-item",{attrs:{label:"确认新密码",prop:"confirm_new_password"}},[r("el-input",{attrs:{type:"password"},model:{value:e.form.confirm_new_password,callback:function(t){e.$set(e.form,"confirm_new_password",t)},expression:"form.confirm_new_password"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submit()}}},[e._v("保存")]),r("el-button",{on:{click:e.cancel}},[e._v("取消")])],1)],1)],1)],1)},Ee=[],Oe={name:"user-edit-my-password",data:function(){return{form:{old_password:"",new_password:"",confirm_new_password:""},formRules:{old_password:[{required:!0,message:"请输入原密码",trigger:"blur"}],new_password:[{required:!0,message:"请输入新密码",trigger:"blur"}],confirm_new_password:[{required:!0,message:"请再次输入新密码",trigger:"blur"}]}}},methods:{submit:function(){var e=this;this.$refs["form"].validate(function(t){if(!t)return!1;e.save()})},save:function(){var e=this;fe.editMyPassword(this.form,function(){e.$router.back()})},cancel:function(){this.$router.back()}}},Ne=Oe,Ue=Object(k["a"])(Ne,Ae,Ee,!1,null,null,null);Ue.options.__file="editMyPassword.vue";var Ce=Ue.exports,Ve=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",[r("system-sidebar"),r("el-main",[r("notification-tab"),r("el-form",{ref:"form",staticStyle:{width:"800px"},attrs:{model:e.form,rules:e.formRules,"label-width":"150px"}},[r("h3",[e._v("邮件服务器配置")]),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"SMTP服务器",prop:"host"}},[r("el-input",{model:{value:e.form.host,callback:function(t){e.$set(e.form,"host",t)},expression:"form.host"}})],1)],1),r("el-col",{attrs:{span:10}},[r("el-form-item",{attrs:{label:"端口",prop:"port"}},[r("el-input",{model:{value:e.form.port,callback:function(t){e.$set(e.form,"port",e._n(t))},expression:"form.port"}})],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"用户名",prop:"user"}},[r("el-input",{model:{value:e.form.user,callback:function(t){e.$set(e.form,"user",t)},expression:"form.user"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"密码",prop:"password"}},[r("el-input",{attrs:{type:"password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1)],1)],1),r("el-alert",{attrs:{title:"通知模板支持html",type:"info",closable:!1}}),r("br"),r("el-form-item",{attrs:{label:"模板",prop:"template"}},[r("el-input",{attrs:{type:"textarea",rows:6,placeholder:""},model:{value:e.form.template,callback:function(t){e.$set(e.form,"template",t)},expression:"form.template"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submit()}}},[e._v("保存")])],1),r("el-button",{attrs:{type:"primary"},on:{click:e.createUser}},[e._v("新增用户")]),r("br"),r("br"),r("h3",[e._v("通知用户")]),e._l(e.receivers,function(t){return r("el-tag",{key:t.email,attrs:{closable:""},on:{close:function(r){e.deleteUser(t)}}},[e._v("\n        "+e._s(t.username)+" - "+e._s(t.email)+"\n      ")])})],2),r("el-dialog",{attrs:{title:"",visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("el-form",{attrs:{model:e.form}},[r("el-form-item",{attrs:{label:"用户名"}},[r("el-input",{model:{value:e.username,callback:function(t){e.username="string"===typeof t?t.trim():t},expression:"username"}})],1),r("el-form-item",{attrs:{label:"邮箱地址"}},[r("el-input",{model:{value:e.email,callback:function(t){e.email="string"===typeof t?t.trim():t},expression:"email"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.saveUser}},[e._v("确 定")])],1)],1)],1)],1)],1)},He=[],De=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-aside",{attrs:{width:"150px"}},[r("el-menu",{attrs:{"default-active":e.currentRoute,mode:"vertical","background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b",router:""}},[r("el-menu-item",{attrs:{index:"/system"}},[e._v("通知配置")]),r("el-menu-item",{attrs:{index:"/system/login-log"}},[e._v("登录日志")])],1)],1)},We=[],Fe={name:"system-sidebar",data:function(){return{}},computed:{currentRoute:function(){return"/system/login-log"===this.$route.path?"/system/login-log":"/system"}}},Ge=Fe,Be=Object(k["a"])(Ge,De,We,!1,null,null,null);Be.options.__file="sidebar.vue";var Je=Be.exports,Qe=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-tabs",{on:{"tab-click":e.changeTab},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[r("el-tab-pane",{attrs:{label:"邮件",name:"email"}}),r("el-tab-pane",{attrs:{label:"Slack",name:"slack"}}),r("el-tab-pane",{attrs:{label:"Webhook",name:"webhook"}})],1),e._m(0)],1)},Ye=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("pre",[r("code",{staticStyle:{color:"darkgray"}},[e._v("\n    通知模板支持的变量\n\n    TaskId 任务ID\n    TaskName 任务名称\n    Status 任务执行结果状态\n    Result 任务执行输出\n  ")])])}],Ke={name:"notification-tab",data:function(){return{activeName:""}},created:function(){var e=this.$route.path.split("/");if(4!==e.length)return"email";this.activeName=e[3]},methods:{changeTab:function(e){this.$router.push("/system/notification/".concat(e.name))}}},Xe=Ke,Ze=Object(k["a"])(Xe,Qe,Ye,!1,null,null,null);Ze.options.__file="tab.vue";var et=Ze.exports,tt={name:"notification-email",data:function(){return{form:{host:"",port:465,user:"",password:"",template:""},formRules:{host:[{required:!0,message:"请输入邮件服务器地址",trigger:"blur"}],port:[{type:"number",required:!0,message:"请输入有效的端口",trigger:"blur"}],user:[{required:!0,message:"请输入用户email",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],template:[{required:!0,message:"请输入通知模板内容",trigger:"blur"}]},receivers:[],username:"",email:"",dialogVisible:!1}},components:{notificationTab:et,systemSidebar:Je},created:function(){this.init()},methods:{createUser:function(){this.dialogVisible=!0},saveUser:function(){var e=this;""!==this.username&&""!==this.email?U.createMailUser({username:this.username,email:this.email},function(){e.dialogVisible=!1,e.init()}):this.$message.error("参数不完整")},deleteUser:function(e){var t=this;U.removeMailUser(e.id,function(){t.init()})},submit:function(){var e=this;this.$refs["form"].validate(function(t){if(!t)return!1;e.save()})},save:function(){var e=this;U.updateMail(this.form,function(){e.$message.success("更新成功"),e.init()})},init:function(){var e=this;this.username="",this.email="",U.mail(function(t){e.form.host=t.host,t.port&&(e.form.port=t.port),e.form.user=t.user,e.form.password=t.password,e.form.template=t.template,e.receivers=t.mail_users})}}},rt=tt,at=(r("7f32"),Object(k["a"])(rt,Ve,He,!1,null,"211ef7cc",null));at.options.__file="email.vue";var ot=at.exports,st=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",[r("system-sidebar"),r("el-main",[r("notification-tab"),r("el-form",{ref:"form",staticStyle:{width:"700px"},attrs:{model:e.form,rules:e.formRules,"label-width":"180px"}},[r("el-form-item",{attrs:{label:"Slack Webhook URL",prop:"url"}},[r("el-input",{model:{value:e.form.url,callback:function(t){e.$set(e.form,"url",t)},expression:"form.url"}})],1),r("el-form-item",{attrs:{label:"模板",prop:"template"}},[r("el-input",{attrs:{type:"textarea",rows:8,placeholder:"",size:"medium"},model:{value:e.form.template,callback:function(t){e.$set(e.form,"template",t)},expression:"form.template"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("保存")])],1),r("h3",[e._v("Channel")]),r("el-button",{attrs:{type:"primary"},on:{click:e.createChannel}},[e._v("新增Channel")]),r("br"),r("br"),e._l(e.channels,function(t){return r("el-tag",{key:t.id,attrs:{closable:""},on:{close:function(r){e.deleteChannel(t)}}},[e._v("\n        "+e._s(t.name)+"\n      ")])})],2),r("el-dialog",{attrs:{title:"",visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("el-form",{attrs:{model:e.form}},[r("el-form-item",{attrs:{label:"Channel名称"}},[r("el-input",{directives:[{name:"focus",rawName:"v-focus"}],model:{value:e.channel,callback:function(t){e.channel="string"===typeof t?t.trim():t},expression:"channel"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.saveChannel}},[e._v("确 定")])],1)],1)],1)],1)],1)},lt=[],nt={name:"notification-slack",data:function(){return{dialogVisible:!1,form:{url:"",template:""},formRules:{url:[{type:"url",required:!0,message:"请输入有效的通知URL",trigger:"blur"}],template:[{required:!0,message:"请输入通知模板",trigger:"blur"}]},channels:[],channel:""}},components:{notificationTab:et,systemSidebar:Je},created:function(){this.init()},methods:{createChannel:function(){this.dialogVisible=!0},submit:function(){var e=this;this.$refs["form"].validate(function(t){if(!t)return!1;e.save()})},save:function(){var e=this;U.updateSlack(this.form,function(){e.$message.success("更新成功"),e.init()})},saveChannel:function(){var e=this;""!==this.channel?U.createSlackChannel(this.channel,function(){e.dialogVisible=!1,e.init()}):this.$message.error("请输入Channel名称")},deleteChannel:function(e){var t=this;U.removeSlackChannel(e.id,function(){t.init()})},init:function(){var e=this;this.channel="",U.slack(function(t){e.form.url=t.url,e.form.template=t.template,e.channels=t.channels})}}},it=nt,ut=(r("00b9"),Object(k["a"])(it,st,lt,!1,null,"510ec18b",null));ut.options.__file="slack.vue";var ct=ut.exports,mt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",[r("system-sidebar"),r("el-main",[r("notification-tab"),r("el-form",{ref:"form",staticStyle:{width:"700px"},attrs:{model:e.form,rules:e.formRules,"label-width":"100px"}},[r("el-alert",{attrs:{title:"通知内容推送到指定URL, POST请求, 设置Header[ Content-Type: application/json]",type:"info",closable:!1}}),r("br"),r("el-form-item",{attrs:{label:"URL",prop:"url"}},[r("el-input",{model:{value:e.form.url,callback:function(t){e.$set(e.form,"url","string"===typeof t?t.trim():t)},expression:"form.url"}})],1),r("el-form-item",{attrs:{label:"模板",prop:"template"}},[r("el-input",{attrs:{type:"textarea",rows:8,placeholder:""},model:{value:e.form.template,callback:function(t){e.$set(e.form,"template","string"===typeof t?t.trim():t)},expression:"form.template"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submit()}}},[e._v("保存")])],1)],1)],1)],1)},ft=[],pt={name:"notification-webhook",data:function(){return{form:{url:"",template:""},formRules:{url:[{type:"url",required:!0,message:"请输入有效的通知URL",trigger:"blur"}],template:[{required:!0,message:"请输入通知模板",trigger:"blur"}]}}},components:{notificationTab:et,systemSidebar:Je},created:function(){this.init()},methods:{submit:function(){var e=this;this.$refs["form"].validate(function(t){if(!t)return!1;e.save()})},save:function(){var e=this;U.updateWebHook(this.form,function(){e.$message.success("更新成功"),e.init()})},init:function(){var e=this;U.webhook(function(t){e.form.url=t.url,e.form.template=t.template})}}},dt=pt,ht=Object(k["a"])(dt,mt,ft,!1,null,null,null);ht.options.__file="webhook.vue";var bt=ht.exports,vt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",[r("el-main",[r("el-form",{ref:"form",staticStyle:{width:"700px"},attrs:{model:e.form,rules:e.formRules,"label-width":"100px"}},[r("h3",[e._v("数据库配置")]),r("el-form-item",{attrs:{label:"数据库选择",prop:"db_type"}},[r("el-select",{on:{change:e.update_port},model:{value:e.form.db_type,callback:function(t){e.$set(e.form,"db_type","string"===typeof t?t.trim():t)},expression:"form.db_type"}},e._l(e.dbList,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"主机名",prop:"db_host"}},[r("el-input",{model:{value:e.form.db_host,callback:function(t){e.$set(e.form,"db_host",t)},expression:"form.db_host"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"端口",prop:"db_port"}},[r("el-input",{model:{value:e.form.db_port,callback:function(t){e.$set(e.form,"db_port",e._n(t))},expression:"form.db_port"}})],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"用户名",prop:"db_username"}},[r("el-input",{model:{value:e.form.db_username,callback:function(t){e.$set(e.form,"db_username",t)},expression:"form.db_username"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"密码",prop:"db_password"}},[r("el-input",{attrs:{type:"password"},model:{value:e.form.db_password,callback:function(t){e.$set(e.form,"db_password",t)},expression:"form.db_password"}})],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"数据库名称",prop:"db_name"}},[r("el-input",{attrs:{placeholder:"如果数据库不存在, 需提前创建"},model:{value:e.form.db_name,callback:function(t){e.$set(e.form,"db_name",t)},expression:"form.db_name"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"表前缀",prop:"db_table_prefix"}},[r("el-input",{model:{value:e.form.db_table_prefix,callback:function(t){e.$set(e.form,"db_table_prefix",t)},expression:"form.db_table_prefix"}})],1)],1)],1),r("h3",[e._v("管理员账号配置")]),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"账号",prop:"admin_username"}},[r("el-input",{model:{value:e.form.admin_username,callback:function(t){e.$set(e.form,"admin_username",t)},expression:"form.admin_username"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"邮箱",prop:"admin_email"}},[r("el-input",{model:{value:e.form.admin_email,callback:function(t){e.$set(e.form,"admin_email",t)},expression:"form.admin_email"}})],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"密码",prop:"admin_password"}},[r("el-input",{attrs:{type:"password"},model:{value:e.form.admin_password,callback:function(t){e.$set(e.form,"admin_password",t)},expression:"form.admin_password"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"确认密码",prop:"confirm_admin_password"}},[r("el-input",{attrs:{type:"password"},model:{value:e.form.confirm_admin_password,callback:function(t){e.$set(e.form,"confirm_admin_password",t)},expression:"form.confirm_admin_password"}})],1)],1)],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submit()}}},[e._v("安装")])],1)],1)],1)],1)},_t=[],gt={name:"index",data:function(){return{form:{db_type:"mysql",db_host:"127.0.0.1",db_port:3306,db_username:"",db_password:"",db_name:"",db_table_prefix:"",admin_username:"",admin_password:"",confirm_admin_password:"",admin_email:""},formRules:{db_type:[{required:!0,message:"请选择数据库",trigger:"blur"}],db_host:[{required:!0,message:"请输入数据库主机名",trigger:"blur"}],db_port:[{type:"number",required:!0,message:"请输入数据库端口",trigger:"blur"}],db_username:[{required:!0,message:"请输入数据库用户名",trigger:"blur"}],db_password:[{required:!0,message:"请输入数据库密码",trigger:"blur"}],db_name:[{required:!0,message:"请输入数据库名称",trigger:"blur"}],admin_username:[{required:!0,message:"请输入管理员账号",trigger:"blur"}],admin_email:[{type:"email",required:!0,message:"请输入管理员邮箱",trigger:"blur"}],admin_password:[{required:!0,message:"请输入管理员密码",trigger:"blur"},{min:6,message:"长度至少6个字符",trigger:"blur"}],confirm_admin_password:[{required:!0,message:"请再次输入管理员密码",trigger:"blur"},{min:6,message:"长度至少6个字符",trigger:"blur"}]},dbList:[{value:"mysql",label:"MySQL"},{value:"postgres",label:"PostgreSql"}],default_ports:{mysql:3306,postgres:5432}}},methods:{update_port:function(e){console.log(e),console.log(this.default_ports[e]),this.form["db_port"]=this.default_ports[e],console.log(this.form["db_port"])},submit:function(){var e=this;this.$refs["form"].validate(function(t){if(!t)return!1;e.save()})},save:function(){var e=this;Dt.store(this.form,function(){e.$router.push("/")})}}},yt=gt,kt=Object(k["a"])(yt,vt,_t,!1,null,null,null);kt.options.__file="index.vue";var wt=kt.exports,xt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",[r("system-sidebar"),r("el-main",[r("el-pagination",{attrs:{background:"",layout:"prev, pager, next, sizes, total",total:e.logTotal,"page-size":20},on:{"size-change":e.changePageSize,"current-change":e.changePage,"prev-click":e.changePage,"next-click":e.changePage}}),r("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:e.logs,border:""}},[r("el-table-column",{attrs:{prop:"id",label:"ID"}}),r("el-table-column",{attrs:{prop:"username",label:"用户名"}}),r("el-table-column",{attrs:{prop:"ip",label:"登录IP"}}),r("el-table-column",{attrs:{label:"登录时间",width:""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("formatTime")(t.row.created))+"\n        ")]}}])})],1)],1)],1)},$t=[],Pt={loginLogList:function(e,t){Ht.get("/system/login-log",e,t)}},St={name:"login-log",data:function(){return{logs:[],logTotal:0,searchParams:{page_size:20,page:1}}},created:function(){this.search()},components:{systemSidebar:Je},methods:{changePage:function(e){this.searchParams.page=e,this.search()},changePageSize:function(e){this.searchParams.page_size=e,this.search()},search:function(){var e=this;Pt.loginLogList(this.searchParams,function(t){e.logs=t.data,e.logTotal=t.total})}}},Tt=St,qt=Object(k["a"])(Tt,xt,$t,!1,null,null,null);qt.options.__file="loginLog.vue";var jt=qt.exports;a["default"].use(c["a"]);var Rt=new c["a"]({routes:[{path:"*",component:x,meta:{noLogin:!0,noNeedAdmin:!0}},{path:"/",redirect:"/task"},{path:"/install",name:"install",component:wt,meta:{noLogin:!0,noNeedAdmin:!0}},{path:"/task",name:"task-list",component:E,meta:{noNeedAdmin:!0}},{path:"/task/create",name:"task-create",component:D},{path:"/task/edit/:id",name:"task-edit",component:D},{path:"/task/log",name:"task-log",component:Y,meta:{noNeedAdmin:!0}},{path:"/host",name:"host-list",component:ae,meta:{noNeedAdmin:!0}},{path:"/host/create",name:"host-create",component:ue},{path:"/host/edit/:id",name:"host-edit",component:ue},{path:"/user",name:"user-list",component:be},{path:"/user/create",name:"user-create",component:we},{path:"/user/edit/:id",name:"user-edit",component:we},{path:"/user/login",name:"user-login",component:qe,meta:{noLogin:!0}},{path:"/user/edit-password/:id",name:"user-edit-password",component:ze},{path:"/user/edit-my-password",name:"user-edit-my-password",component:Ce,meta:{noNeedAdmin:!0}},{path:"/system",redirect:"/system/notification/email"},{path:"/system/notification/email",name:"system-notification-email",component:ot},{path:"/system/notification/slack",name:"system-notification-slack",component:ct},{path:"/system/notification/webhook",name:"system-notification-webhook",component:bt},{path:"/system/login-log",name:"login-log",component:jt}]});Rt.beforeEach(function(e,t,r){if(e.meta.noLogin)r();else{if(b.getters.user.token){if(b.getters.user.isAdmin||e.meta.noNeedAdmin)return void r();if(!b.getters.user.isAdmin)return void r({path:"/404.html"})}r({path:"/user/login",query:{redirect:e.fullPath}})}});var Lt=Rt,It=r("4328"),Mt=r.n(It),zt="加载失败, 请稍后再试",At=0,Et=401,Ot=801;function Nt(e,t){e.then(function(e){return Ct(e,t)}).catch(function(e){return Vt(e)})}function Ut(e,t){switch(e){case Ot:return Lt.push("/install"),!1;case Et:return Lt.push("/user/login"),!1}return e===At||(o["Message"].error({message:t}),!1)}function Ct(e,t){Ut(e.data.code,e.data.message)&&t&&t(e.data.data,e.data.code,e.data.message)}function Vt(e){o["Message"].error({message:"请求失败 - "+e})}u.a.defaults.baseURL="api",u.a.defaults.timeout=1e4,u.a.defaults.responseType="json",u.a.interceptors.request.use(function(e){return e.headers["Auth-Token"]=b.getters.user.token,e},function(e){return o["Message"].error({message:zt}),Promise.reject(e)}),u.a.interceptors.response.use(function(e){return e},function(e){return o["Message"].error({message:zt}),Promise.reject(e)});var Ht={get:function(e,t,r){var a=u.a.get(e,{params:t});Nt(a,r)},batchGet:function(e,t){var r=[],a=!0,o=!1,s=void 0;try{for(var l,n=e[Symbol.iterator]();!(a=(l=n.next()).done);a=!0){var i=l.value,c={};void 0!==i.params&&(c=i.params),r.push(u.a.get(i.uri,{params:c}))}}catch(m){o=!0,s=m}finally{try{a||null==n.return||n.return()}finally{if(o)throw s}}u.a.all(r).then(u.a.spread(function(){for(var e=[],r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];for(var s=0;s<a.length;s++){var l=a[s];if(!Ut(l.data.code,l.data.message))return;e.push(l.data.data)}t.apply(void 0,e)})).catch(function(e){return Vt(e)})},post:function(e,t,r){var a=u.a.post(e,Mt.a.stringify(t),{headers:{post:{"Content-Type":"application/x-www-form-urlencoded"}}});Nt(a,r)}},Dt={store:function(e,t){Ht.post("/install/store",e,t)},status:function(e){Ht.get("/install/status",{},e)}},Wt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div")},Ft=[],Gt={name:"app-header",data:function(){return{}}},Bt=Gt,Jt=Object(k["a"])(Bt,Wt,Ft,!1,null,null,null);Jt.options.__file="header.vue";var Qt=Jt.exports,Yt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{},[r("el-menu",{attrs:{"default-active":e.currentRoute,mode:"horizontal","background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b",router:""}},[r("el-row",[r("el-col",{attrs:{span:2}},[r("el-menu-item",{attrs:{index:"/task"}},[e._v("任务管理")])],1),r("el-col",{attrs:{span:2}},[r("el-menu-item",{attrs:{index:"/host"}},[e._v("任务节点")])],1),r("el-col",{attrs:{span:2}},[this.$store.getters.user.isAdmin?r("el-menu-item",{attrs:{index:"/user"}},[e._v("用户管理")]):e._e()],1),r("el-col",{attrs:{span:2}},[this.$store.getters.user.isAdmin?r("el-menu-item",{attrs:{index:"/system"}},[e._v("系统管理")]):e._e()],1),r("el-col",{attrs:{span:16}}),r("el-col",{staticStyle:{float:"right"},attrs:{span:2}},[this.$store.getters.user.token?r("el-submenu",{attrs:{index:"userStatus"}},[r("template",{slot:"title"},[e._v(e._s(this.$store.getters.user.username))]),r("el-menu-item",{attrs:{index:"/user/edit-my-password"}},[e._v("修改密码")]),r("el-menu-item",{attrs:{index:"/user/logout"},on:{click:e.logout}},[e._v("退出")])],2):e._e()],1)],1)],1)],1)},Kt=[],Xt={name:"app-nav-menu",data:function(){return{}},computed:{currentRoute:function(){if("/"===this.$route.path)return"/task";var e=this.$route.path.split("/");return"/".concat(e[1])}},methods:{logout:function(){this.$store.commit("logout"),this.$router.push("/")}}},Zt=Xt,er=Object(k["a"])(Zt,Yt,Kt,!1,null,null,null);er.options.__file="navMenu.vue";var tr=er.exports,rr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div")},ar=[],or={name:"app-footer",data:function(){return{}}},sr=or,lr=Object(k["a"])(sr,rr,ar,!1,null,null,null);lr.options.__file="footer.vue";var nr=lr.exports,ir={name:"App",data:function(){return{}},created:function(){var e=this;Dt.status(function(t){t||e.$router.push("/install")})},components:{appHeader:Qt,appNavMenu:tr,appFooter:nr}},ur=ir,cr=(r("034f"),Object(k["a"])(ur,l,n,!1,null,null,null));cr.options.__file="App.vue";var mr=cr.exports;a["default"].config.productionTip=!1,a["default"].use(s.a),a["default"].directive("focus",{inserted:function(e){e.focus()}}),a["default"].prototype.$appConfirm=function(e){this.$confirm("确定执行此操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e()})},a["default"].filter("formatTime",function(e){var t=function(e){return e>=10?e:"0"+e},r=new Date(e),a=r.getFullYear()+"-"+t(r.getMonth()+1)+"-"+t(r.getDate())+" "+t(r.getHours())+":"+t(r.getMinutes())+":"+t(r.getSeconds());return 0!==a.indexOf("20")?"":a}),new a["default"]({router:Lt,store:b,render:function(e){return e(mr)},template:"<App/>"}).$mount("#app")},"5e52":function(e,t,r){},"64a9":function(e,t,r){},7229:function(e,t,r){"use strict";var a=r("782d"),o=r.n(a);o.a},"782d":function(e,t,r){},"7f32":function(e,t,r){"use strict";var a=r("cd8f"),o=r.n(a);o.a},cd8f:function(e,t,r){}});
//# sourceMappingURL=app.d36e2b9f.js.map